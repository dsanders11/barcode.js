<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Generate Barcode Demo</title>
    <script type="text/javascript" src="../dist/w69b.qrcode.min.js"></script>
  </head>
  <body>
    <textarea id="input">helloö€</textarea>
    <br/>
    <canvas width="400" height="400" id="canvas"></canvas>
    <button id="save">save</button>
    <button id="save_svg">saveSVG</button>
    <script type="text/javascript">
      (function() {
        var input, formats, canvas;

        function getFormat() {
          var format = -1;
          if (formats.selectedIndex >= 0) {
              let option = formats.options[formats.selectedIndex];
              format = parseInt(option.value);
          }
          return format;
        }

        function renderBarcode() {
          var txt = input.value;
          w69b.encoding.drawOnCanvas(txt, getFormat(), canvas);
        }

        function onSave(ev) {
          w69b.imgtools.getCanvasAsBlob(canvas, function(blob) {
            w69b.FileSaver.saveAs(blob, 'bla.png');
          });
        }

        function onSaveSvg(ev) {
          var txt = input.value;
          var svg = w69b.encoding.drawAsSVG(
            txt, getFormat(), canvas.width, canvas.height, 100);
          var blob = new Blob([svg]);
          w69b.FileSaver.saveAs(blob, 'bla.svg');
        }

        function load() {
          formats = document.getElementById('format');
          // Add available formats
          Object.keys(w69b.BarcodeFormat).forEach(function(format, idx) {
            let option = document.createElement("option");
            option.text = format;
            option.value = w69b.BarcodeFormat[format];
            if (format === "QR_CODE") {
              option.selected = true;
            }
            formats.add(option);
          });
          input = document.getElementById('input');
          canvas = document.getElementById('canvas');
          var save = document.getElementById('save');
          var saveSvg = document.getElementById('save_svg');
          input.addEventListener('keyup', renderBarcode, false);
          save.addEventListener('click', onSave, false);
          saveSvg.addEventListener('click', onSaveSvg, false);
          renderBarcode();
        }

        load();
      })();
    </script>
  </body>
</html>
